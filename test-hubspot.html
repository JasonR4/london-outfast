<!DOCTYPE html>
<html>
<head>
    <title>Test HubSpot Routes</title>
</head>
<body>
    <h1>Testing HubSpot Integration</h1>
    <div id="results"></div>
    
    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2.53.0';
        
        const supabase = createClient(
            'https://qknytkvatzsmesmvyalv.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrbnl0a3ZhdHpzbWVzbXZ5YWx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MTY0MjcsImV4cCI6MjA2OTk5MjQyN30.bpEM3jVhIymmO05GR4s8FTkXQ6uZc3ksP7uNtBDb3fQ'
        );
        
        async function testHubSpotRoutes() {
            const results = [];
            const resultsDiv = document.getElementById('results');
            
            // Test 1: Brief Route
            console.log('üîç Testing Brief Route...');
            resultsDiv.innerHTML += '<p>Testing Brief Route...</p>';
            try {
                const { data, error } = await supabase.functions.invoke('submit-brief', {
                    body: {
                        firstname: 'Test',
                        lastname: 'Brief Route',
                        email: 'test.brief.route.live@example.com',
                        phone: '+442045243019',
                        company: 'Test Company Brief Route Live',
                        website: 'https://test-brief-route-live.com',
                        jobtitle: 'Marketing Manager',
                        budget_band: '15000',
                        objective: 'Brand awareness',
                        target_areas: ['Westminster', 'Camden'],
                        formats: ['48-sheet', '6-sheet'],
                        start_month: '2025-03-01',
                        creative_status: 'Ready',
                        notes: 'LIVE TEST: Brief route HubSpot integration - [brief] route',
                        mbl: true,
                        source_path: '/brief?test=live-hubspot-sync'
                    }
                });
                
                results.push({ route: 'brief', status: error ? 'error' : 'success', data, error });
                resultsDiv.innerHTML += `<p>‚úÖ Brief: ${error ? 'ERROR - ' + error.message : 'SUCCESS'}</p>`;
            } catch (e) {
                results.push({ route: 'brief', status: 'error', error: e.message });
                resultsDiv.innerHTML += `<p>‚ùå Brief: ERROR - ${e.message}</p>`;
            }
            
            // Test 2: Format Route
            console.log('üîç Testing Format Route...');
            resultsDiv.innerHTML += '<p>Testing Format Route...</p>';
            try {
                const { data, error } = await supabase.functions.invoke('submit-quote', {
                    body: {
                        quoteSessionId: 'test-format-session-001',
                        contact: {
                            firstName: 'Test',
                            lastName: 'Format Route',
                            email: 'test.format.route.live@example.com',
                            phone: '+442045243019',
                            company: 'Test Company Format Route Live',
                            website: 'https://test-format-route-live.com',
                            notes: 'LIVE TEST: Format route HubSpot integration - [outdoor-media] route'
                        },
                        source: 'outdoor-media'
                    }
                });
                
                results.push({ route: 'outdoor-media', status: error ? 'error' : 'success', data, error });
                resultsDiv.innerHTML += `<p>‚úÖ Format: ${error ? 'ERROR - ' + error.message : 'SUCCESS'}</p>`;
            } catch (e) {
                results.push({ route: 'outdoor-media', status: 'error', error: e.message });
                resultsDiv.innerHTML += `<p>‚ùå Format: ERROR - ${e.message}</p>`;
            }
            
            // Test 3: Configurator Route
            console.log('üîç Testing Configurator Route...');
            resultsDiv.innerHTML += '<p>Testing Configurator Route...</p>';
            try {
                const { data, error } = await supabase.functions.invoke('submit-quote', {
                    body: {
                        quoteSessionId: 'test-config-session-002',
                        contact: {
                            firstName: 'Test',
                            lastName: 'Configurator Route',
                            email: 'test.config.route.live@example.com',
                            phone: '+442045243019',
                            company: 'Test Company Configurator Route Live',
                            website: 'https://test-config-route-live.com',
                            notes: 'LIVE TEST: Configurator route HubSpot integration - [configurator] route'
                        },
                        source: 'configurator'
                    }
                });
                
                results.push({ route: 'configurator', status: error ? 'error' : 'success', data, error });
                resultsDiv.innerHTML += `<p>‚úÖ Configurator: ${error ? 'ERROR - ' + error.message : 'SUCCESS'}</p>`;
            } catch (e) {
                results.push({ route: 'configurator', status: 'error', error: e.message });
                resultsDiv.innerHTML += `<p>‚ùå Configurator: ERROR - ${e.message}</p>`;
            }
            
            // Test 4: Smart Quote Route
            console.log('üîç Testing Smart Quote Route...');
            resultsDiv.innerHTML += '<p>Testing Smart Quote Route...</p>';
            try {
                const { data, error } = await supabase.functions.invoke('submit-quote', {
                    body: {
                        quoteSessionId: 'test-smart-session-003',
                        contact: {
                            firstName: 'Test',
                            lastName: 'Smart Quote Route',
                            email: 'test.smart.route.live@example.com',
                            phone: '+442045243019',
                            company: 'Test Company Smart Quote Route Live',
                            website: 'https://test-smart-route-live.com',
                            notes: 'LIVE TEST: Smart quote route HubSpot integration - [smart-quote] route'
                        },
                        source: 'smart-quote'
                    }
                });
                
                results.push({ route: 'smart-quote', status: error ? 'error' : 'success', data, error });
                resultsDiv.innerHTML += `<p>‚úÖ Smart Quote: ${error ? 'ERROR - ' + error.message : 'SUCCESS'}</p>`;
            } catch (e) {
                results.push({ route: 'smart-quote', status: 'error', error: e.message });
                resultsDiv.innerHTML += `<p>‚ùå Smart Quote: ERROR - ${e.message}</p>`;
            }
            
            console.log('üéØ All tests completed:', results);
            resultsDiv.innerHTML += '<h2>All tests completed! Check console for details.</h2>';
        }
        
        // Start tests
        testHubSpotRoutes();
    </script>
</body>
</html>