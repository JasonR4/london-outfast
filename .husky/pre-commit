#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"



# 1) Block legacy/forbidden strings
FAIL_GREP() {
  MSG="$1"; shift
  if git grep -nE "$@" -- . ':!package-lock.json' ':!yarn.lock' > /dev/null; then
    echo "❌ Pre-commit blocked: $MSG"
    git grep -nE "$@" -- . ':!package-lock.json' ':!yarn.lock'
    exit 1
  fi
}



# No location markup
FAIL_GREP "Found legacy location markup usage" "(locationMarkup|Location Markup Percentage)"



# No surcharge logic
FAIL_GREP "Found legacy surcharge usage" "(calculateNonConsecutiveSurcharge|Non-consecutive setup surcharge)"



# No ad-hoc money formatting / VAT helper
FAIL_GREP "Use formatCurrency() only (no toLocaleString or formatCurrencyWithVAT)" "(toLocaleString\(|formatCurrencyWithVAT\()"



# 2) Run tests fast
npm test --silent -- --passWithNoTests || exit 1



# 3) Lint (optional but recommended)
npm run lint --silent || exit 1



echo "✅ Pre-commit checks passed"